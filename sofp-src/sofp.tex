%% LyX 2.3.3 created this file.  For more info, see http://www.lyx.org/.
%% Do not edit unless you really know what you are doing.
\documentclass[10pt,russian,english,open=any,numbers=noenddot,index=totoc,bibliography=totoc,listof=totoc,fontsize=10pt]{scrbook}
\usepackage{amsmath}
\usepackage{mathpazo}
\usepackage{helvet}
\renewcommand{\ttdefault}{cmtt}
\usepackage{newtxmath}
\usepackage[T2A,T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage[paperwidth=7.444in,paperheight=9.68in]{geometry}
\geometry{verbose,tmargin=1.1cm,bmargin=1.35cm,lmargin=2.15cm,rmargin=1.35cm,headsep=0.4cm,footskip=0.75cm}
\setcounter{secnumdepth}{3}
\usepackage{xcolor}
\usepackage{babel}
\usepackage{array}
\usepackage{verbatim}
\usepackage{wrapfig}
\usepackage{calc}
\usepackage{textcomp}
\usepackage{tipa}
\usepackage{tipx}
\usepackage{mathdots}
\usepackage{stmaryrd}
\usepackage{makeidx}
\makeindex
\usepackage{graphicx}
\usepackage{wasysym}
\usepackage[all]{xy}
\usepackage[unicode=true,
 bookmarks=true,bookmarksnumbered=true,bookmarksopen=true,bookmarksopenlevel=2,
 breaklinks=true,pdfborder={0 0 0},pdfborderstyle={},backref=page,colorlinks=true]
 {hyperref}
\hypersetup{pdftitle={The Science of Functional Programming: A Tutorial, with Examples in Scala},
 pdfauthor={Sergei Winitzki},
 pdfsubject={Functional programming},
 pdfkeywords={Functional programming, Type theory, Category theory, Formal logic, Programming languages},
 linkcolor=blue}

\makeatletter

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% LyX specific LaTeX commands.
\newcommand{\noun}[1]{\textsc{#1}}
\DeclareRobustCommand{\cyrtext}{%
  \fontencoding{T2A}\selectfont\def\encodingdefault{T2A}}
\DeclareRobustCommand{\textcyr}[1]{\leavevmode{\cyrtext #1}}

%% Because html converters don't know tabularnewline
\providecommand{\tabularnewline}{\\}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% Textclass specific LaTeX commands.
\newenvironment{lyxcode}
	{\par\begin{list}{}{
		\setlength{\rightmargin}{\leftmargin}
		\setlength{\listparindent}{0pt}% needed for AMS classes
		\raggedright
		\setlength{\itemsep}{0pt}
		\setlength{\parsep}{0pt}
		\normalfont\ttfamily}%
	 \item[]}
	{\end{list}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% User specified LaTeX commands.
\usepackage[all]{xy} % xypic

% pstricks with support for pdflatex
%\usepackage{pdftricks}
%\begin{psinputs}
%   \usepackage{pstricks}
%   \usepackage{multido}
%\end{psinputs}
\usepackage{pstricks}

% Fix the numbering of exercises: subsubsections appear as paragraphs but are numbered.
\usepackage{titlesec}
% See https://tex.stackexchange.com/questions/7627/how-to-reference-paragraph
% See the `titlesec` package documentation at http://www.ctex.org/documents/packages/layout/titlesec.pdf
\titleformat{\subsubsection}[runin]{\normalfont\normalsize\bfseries}{}{0pt}{}
\titlespacing{\subsubsection}{0pt}{5pt}{3\wordsep}
\titleformat{\subparagraph}[runin]{\normalfont\normalsize\bfseries}{}{0pt}{}
\titlespacing{\subparagraph}{\parindent}{\parskip}{3\wordsep}
\titlespacing{\paragraph}{0pt}{3pt}{2\wordsep}

% Make page headers and page numbers smaller
\addtokomafont{pagehead}{\small}
\addtokomafont{pagenumber}{\small}

% Double-stroked fonts to replace the non-working \mathbb{1}.
\usepackage{bbold}
\DeclareMathAlphabet{\bbnumcustom}{U}{BOONDOX-ds}{m}{n} % Use BOONDOX-ds or bbold.
\newcommand{\custombb}[1]{\bbnumcustom{#1}}
% The LyX document will define a macro \bbnum{#1} that calls \custombb{#1}.

% Scala syntax highlighting. See https://tex.stackexchange.com/questions/202479/unable-to-define-scala-language-with-listings
%\usepackage[T1]{fontenc}
%\usepackage[utf8]{inputenc}
%\usepackage{beramono}
%\usepackage{listings}
% The listing settings are now supported by LyX in a separate section "Listings".
\usepackage{xcolor}

\definecolor{scalakeyword}{rgb}{0.16,0.07,0.5}
\definecolor{dkgreen}{rgb}{0,0.6,0}
\definecolor{gray}{rgb}{0.5,0.5,0.5}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\definecolor{aqua}{rgb}{0.9,0.96,0.999}
\definecolor{scalatype}{rgb}{0.2,0.3,0.2}

%\lstdefinestyle{myScalastyle}{
%  language=scala, % This should be defined first!!! Otherwise it overrides all customization via morekeywords / otherkeywords.
%  otherkeywords={{=,=>,<-,<\%,<:,>:,\#,@,*,+,-,/,::,:,[,]}},
%  frame=tb,
%  aboveskip=2mm,
%  belowskip=2mm,
%  showstringspaces=false,
%  columns=flexible,
%  basicstyle={\small\ttfamily},
%  extendedchars=true,
%  %numbers=none,
%  numberstyle=\tiny\color{gray},
%  keywordstyle=\color{blue},
%  commentstyle=\color{dkgreen},
%  stringstyle=\color{mauve},
%  frame=single,
%  framerule=0.01mm,
%  breaklines=true,
%  breakatwhitespace=true,
%  tabsize=3,
%  framexleftmargin=4mm, framexrightmargin=4mm,
%  xleftmargin=4mm, xrightmargin=4mm, % Making these margins the same has a good effect.
%  framextopmargin=0.5mm, framexbottommargin=.5mm,
%  fillcolor=\color{aqua},
%  rulecolor=\color{aqua},
%  rulesepcolor=\color{aqua},
%  backgroundcolor=\color{aqua},
%  mathescape=true,
%}

% Example usage: \begin{lstlisting}[style=myScalastyle]  object blah \end{lstlisting}
%\newenvironment{scala}{\begin{lstlisting}[style=myScalastyle]}{\end{lstlisting}}
%\lstnewenvironment{scala}{\lstset{style=myScalastyle}}{}

\usepackage[nocenter]{qtree} % simple tree drawing
\usepackage{relsize} % make math symbols larger or smaller
\usepackage{stmaryrd} % some extra symbols such as \fatsemi
% Note: using \forwardcompose inside a \text{} will cause a LaTeX error!
\newcommand{\forwardcompose}{\hspace{1.2pt}\ensuremath\mathsmaller{\fatsemi}\hspace{1.5pt}}
% this is ugly, I used this before I found \fatsemi:
%\newcommand{\bef}{\hspace{1.0pt}\ensuremath\raisebox{2pt}{$\mathsmaller{\mathsmaller{\circ}}$}\hspace{-2.9pt},}
%\makeatletter
% Macros to assist LyX with XYpic when using scaling.
\newcommand{\xyScaleX}[1]{%
\makeatletter
\xydef@\xymatrixcolsep@{#1}
\makeatother
} % end of \xyScaleX
\makeatletter
\newcommand{\xyScaleY}[1]{%
\makeatletter
\xydef@\xymatrixrowsep@{#1}
\makeatother
} % end of \xyScaleY

% Increase the default vertical space inside table cells.
\renewcommand\arraystretch{1.4}

% Make underline green.
\definecolor{greenunder}{rgb}{0.1,0.6,0.2}
%\newcommand{\munderline}[1]{{\color{greenunder}\underline{{\color{black}#1}}\color{black}}}
\def\mathunderline#1#2{\color{#1}\underline{{\color{black}#2}}\color{black}}
% The LyX document will define a macro \gunderline{#1} that will use \mathunderline with the color `greenunder`.
%\def\gunderline#1{\mathunderline{greenunder}{#1}} % This is now defined by LyX itself with GUI support.

\newcommand{\shui}{\begin{CJK}{UTF8}{gbsn}Ê∞¥\end{CJK}}
\usepackage{CJKutf8} % For occasional Chinese characters. Also, add "russian" to documentclass.

% Prepare settings for imposing a color background for all displayed math. This will be done by a script later.
\usepackage{empheq} % Background on all displayed equations.
\definecolor{mathbg}{rgb}{1.0, .98, .87}
\newcommand*\mymathbgbox[1]{%
\setlength{\fboxsep}{0pt}%
\colorbox{mathbg}{\hspace{0.5mm}#1\hspace{0.5mm}}}
%\renewenvironment{align}{%
%\begin{empheq}[box=\mymathbgbox]{align}}{%
%\endalign\end{empheq}}
% Run a command such as LC_ALL=C sed -i bak -e 's|\\begin{align}|\\begin{empheq}[box=\\mymathbgbox]{align}|; s|\\end{align}|\\end{empheq}|' sofp-filterable.tex

\makeatother

\usepackage{listings}
\lstset{language=Scala,
morekeywords={{scala}},
otherkeywords={=,=>,<-,<\%,<:,>:,\#,@,:,[,],.,???},
keywordstyle={\color{scalakeyword}},
morekeywords={[2]{String,Short,Int,Long,Char,Boolean,Double,Float,BigDecimal,Seq,Map,Set,List,Option,Either,Future,Vector,Range,IndexedSeq,Try,true,false,None,Some,Left,Right,Nothing,Any,Array,Unit,Iterator,Stream}},
keywordstyle={[2]{\color{scalatype}}},
frame=tb,
aboveskip={1.5mm},
belowskip={0.5mm},
showstringspaces=false,
columns=fullflexible,
keepspaces=true,
basicstyle={\smaller\ttfamily},
extendedchars=true,
numbers=none,
numberstyle={\tiny\color{gray}},
commentstyle={\color{dkgreen}},
stringstyle={\color{mauve}},
frame=single,
framerule={0.0mm},
breaklines=true,
breakatwhitespace=true,
tabsize=3,
framexleftmargin={0.5mm},
framexrightmargin={0.5mm},
xleftmargin={1.5mm},
xrightmargin={1.5mm},
framextopmargin={0.5mm},
framexbottommargin={0.5mm},
fillcolor={\color{aqua}},
rulecolor={\color{aqua}},
rulesepcolor={\color{aqua}},
backgroundcolor={\color{aqua}},
mathescape=false,
extendedchars=true}
\addto\captionsenglish{\renewcommand{\lstlistingname}{\inputencoding{latin9}Listing}}
\addto\captionsrussian{\renewcommand{\lstlistingname}{\inputencoding{koi8-r}Ï…”‘…Œ«}}
\renewcommand{\lstlistingname}{\inputencoding{latin9}Listing}

\begin{document}
\extratitle{\hfill{}The Science of Functional Programming\hspace{1in}}
\title{The Science of Functional Programming}
\subtitle{A Tutorial, with Examples in Scala}
\author{by Sergei Winitzki, Ph.D.}
\date{Draft version of \today}
\publishers{Published by \textbf{\href{http://lulu.com}{lulu.com}} in 2019}
\uppertitleback{Copyright \copyright\  2018-2019 by Sergei Winitzki.\\
~\\
Published at \texttt{\href{http://www.lulu.com/content/paperback-book/24915714}{http://www.lulu.com/content/paperback-book/24915714}}\\
~\\
ISBN: 978-0-359-76877-6\\
~\\
Permission is granted to copy, distribute and/or modify this document
under the terms of the GNU Free Documentation License, Version 1.2
or any later version published by the Free Software Foundation; with
no \emph{Invariant Sections}, no \emph{Front-Cover Texts}, and no
\emph{Back-Cover Texts}. A copy of the license is included in the
section entitled ‚ÄúGNU Free Documentation License‚Äù (Appendix~\ref{sec:GFDL}).\\
~\\
A \emph{Transparent} copy of the source code for the book (LyX, LaTeX,
graphics files, and build scripts), together with a full-color hyperlinked
PDF file, is available at \texttt{\href{https://github.com/winitzki/sofp}{https://github.com/winitzki/sofp}}
as \inputencoding{latin9}\lstinline!sofp-src/sofp.pdf!\inputencoding{utf8}.
 See the file \inputencoding{latin9}\lstinline!README.md!\inputencoding{utf8}
for compilation instructions.}
\lowertitleback{This pedagogical tutorial book presents the theoretical knowledge
needed by practitioners of the functional programming paradigm. The
main topics covered are: working with functional collections and recursion;
the fundamental type and code constructions in functional programming;
reasoning about types and code with the Curry-Howard correspondence;
laws, structure theorems, and code derivation for functors, monads,
and other important typeclasses; free type constructions; and recursive
types. Detailed explanations are logically developed and accompanied
by full derivations and worked examples tested in the Scala interpreter,
as well as exercises. Readers should have a working knowledge of programming;
e.g.\ be able to write code that reads a small text file and prints
the number of words in it. The mathematical complexity of the calculations
in this book is at the level of high-school mathematics, similar to
simplifying the expressions $\frac{1}{x-2}-\frac{1}{x+2}$ and $\frac{d}{dx}\left((x+1)e^{-x}\right)$.}

\maketitle
\frontmatter\pagenumbering{roman}

\tableofcontents{}

\mainmatter\pagenumbering{arabic}
\global\long\def\gunderline#1{\mathunderline{greenunder}{#1}}%
\global\long\def\bef{\forwardcompose}%
\global\long\def\bbnum#1{\custombb{#1}}%

\begin{comment}
Each chapter is now a separate file. The LyX macro definitions should
be included at the top of each chapter file; then each chapter can
be previewed correctly by LyX, separately from other chapters, which
is faster.
\end{comment}
\include{sofp-preface}

\part{Beginner level}

\include{sofp-nameless-functions}\include{sofp-induction}\include{sofp-disjunctions}

\part{Intermediate level}

\include{sofp-higher-order-functions}\include{sofp-curry-howard}

\include{sofp-functors}\include{sofp-typeclasses}\include{sofp-filterable}\include{sofp-monads}\include{sofp-applicative}\include{sofp-traversable}

\part{Advanced level}

\include{sofp-free-type}\include{sofp-transformers}\include{sofp-recursive}\include{sofp-coinductive}\include{sofp-irregular}

\part{Discussions}

\include{sofp-summary}

\include{sofp-essays}

\part{Appendixes}


\appendix
\include{sofp-appendices}

\listoftables

\listoffigures

\printindex
\end{document}
